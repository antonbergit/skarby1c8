&НаКлиенте
Процедура ПутьКФайлуНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	ВыбратьКаталог(ПутьКФайлу);

КонецПроцедуры

&НаКлиенте
Процедура ВыбратьКаталог(Каталог)
	
	Если Не ПодключитьРасширениеРаботыСФайлами() Тогда
		//ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru = 'Для данной операции необходимо установить расширение работы с файлами. Операция займет несколько секунд...';uk='Для цієї операції необхідно встановити розширення роботи з файлами. Операція займе кілька секунд...'"));
		НачатьУстановкуРасширенияРаботыСФайлами();
		Возврат;
	КонецЕсли;
	
	ДиалогВыбораФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	ДиалогВыбораФайла.Фильтр                      = НСтр("ru='Текстовый файл (*.csv)|*.csv';uk='Текстовий файл (*.csv)|*.csv'");
	ДиалогВыбораФайла.Заголовок                   = Заголовок;
	ДиалогВыбораФайла.ПредварительныйПросмотр     = Ложь;
	ДиалогВыбораФайла.Расширение                  = "csv";
	ДиалогВыбораФайла.ИндексФильтра               = 0;
	ДиалогВыбораФайла.ПолноеИмяФайла              = Элементы.ПутьКФайлу.ТекстРедактирования;
	ДиалогВыбораФайла.ПроверятьСуществованиеФайла = Ложь;

	ДиалогВыбораФайла.Каталог   = Каталог; //ДобавитьКонечныйРазделительПути(Каталог);
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ДиалогВыбораАдреса", ЭтаФорма);
	
	ДиалогВыбораФайла.Показать(ОписаниеОповещения);
	
КонецПроцедуры

&НаКлиенте
Процедура ДиалогВыбораАдреса(Ответ, Параметры) Экспорт
	
	Если ТипЗнч(Ответ) = Тип("Массив") И Ответ.Количество() <> 0 Тогда
		ПутьКФайлу = Ответ[0];
	КонецЕсли;	
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьРеквизиты()

	ЭтоНоменклатура = ВидОперации = "Номенклатура";
	ЭтоКонтрагенты = ВидОперации = "Контрагенты";
	ЭтоОстатки = ВидОперации = "Остатки";
	ЭтоЦены = ВидОперации = "Цены";
	
	Элементы.СписокЗагрузкиАртикул.Видимость = ЭтоНоменклатура;
	Элементы.СписокЗагрузкиКод.Видимость = ЭтоНоменклатура;
	Элементы.СписокЗагрузкиНДС.Видимость = ЭтоНоменклатура;
	
	Элементы.СписокЗагрузкиШтрихКод.Видимость = ЭтоНоменклатура;
	
	Элементы.СписокЗагрузкиНаименованиеПолное.Видимость = ЭтоКонтрагенты;
	Элементы.СписокЗагрузкиИНН.Видимость = ЭтоКонтрагенты;
	Элементы.СписокЗагрузкиЕДРПОУ.Видимость = ЭтоКонтрагенты;
	
	Элементы.СписокЗагрузкиКоличество.Видимость = ЭтоОстатки;
	Элементы.СписокЗагрузкиНомерГТД.Видимость = ЭтоОстатки;
	Элементы.Склад.Видимость = ЭтоОстатки;
	
	Элементы.СписокЗагрузкиХарактеристикаНоменклатуры.Видимость = ЭтоЦены;
	
	Элементы.СтранаПроисхождения.Видимость = ЭтоЦены;
	
	Если ЭтоОстатки ИЛИ ЭтоЦены Тогда
		Элементы.СтранаПроисхождения.ПодсказкаВвода = НСтр("ru='<Запоняется только для новой номенклатуры>';uk='<Запоняется тільки для нової номенклатури>'");
	Иначе
		Элементы.СтранаПроисхождения.ПодсказкаВвода = "";
	КонецЕсли;
	
	Элементы.СписокЗагрузкиЦена.Видимость = ЭтоОстатки ИЛИ ЭтоЦены;
	Элементы.СписокЗагрузкиКомментарий.Видимость = ЭтоНоменклатура ИЛИ ЭтоКонтрагенты;
	Элементы.ВидЦен.Видимость = ЭтоЦены;
	Элементы.Дата.Видимость = ЭтоОстатки ИЛИ ЭтоЦены;
	
	Реквизиты.Очистить();
	НоваяСтрока = Реквизиты.Добавить();
	НоваяСтрока.ИмяРеквизита = "Наименование";
	НоваяСтрока.Обязательный = Истина;
	
	Если ЭтоНоменклатура ИЛИ ЭтоЦены Тогда
		НоваяСтрока = Реквизиты.Добавить();
		НоваяСтрока.ИмяРеквизита = "Артикул";
		НоваяСтрока = Реквизиты.Добавить();
		НоваяСтрока.ИмяРеквизита = "Код";
		
		Если ЭтоНоменклатура Тогда
			НоваяСтрока = Реквизиты.Добавить();
			НоваяСтрока.ИмяРеквизита = "Ндс";
		Иначе// ЭтоЦены
			НоваяСтрока = Реквизиты.Добавить();
			НоваяСтрока.ИмяРеквизита = "Цена";
			НоваяСтрока.Обязательный = Истина;
		КонецЕсли;	
		
		Если ИдКонф = "UNF" Тогда
			НоваяСтрока = Реквизиты.Добавить();
			НоваяСтрока.ИмяРеквизита = "Штрих-код";
		КонецЕсли;
		
		НоваяСтрока = Реквизиты.Добавить();
		НоваяСтрока.ИмяРеквизита = "Комментарий";
		
	ИначеЕсли ЭтоКонтрагенты Тогда
		
		НоваяСтрока = Реквизиты.Добавить();
		НоваяСтрока.ИмяРеквизита = "НаименованиеПолное";
		НоваяСтрока = Реквизиты.Добавить();
		НоваяСтрока.ИмяРеквизита = "ИНН";
		НоваяСтрока = Реквизиты.Добавить();
		НоваяСтрока.ИмяРеквизита = "ЕДРПОУ";
		НоваяСтрока = Реквизиты.Добавить();
		НоваяСтрока.ИмяРеквизита = "Комментарий";
		
	ИначеЕсли ЭтоОстатки Тогда
	
		НоваяСтрока = Реквизиты.Добавить();
		НоваяСтрока.ИмяРеквизита = "Количество";
		НоваяСтрока.Обязательный = Истина;
		НоваяСтрока = Реквизиты.Добавить();
		НоваяСтрока.ИмяРеквизита = "Цена";
		НоваяСтрока = Реквизиты.Добавить();
		НоваяСтрока.ИмяРеквизита = "ГТД";
	КонецЕсли;
	
КонецПроцедуры // ЗаполнитьРеквизиты()

&НаСервере
Функция ЗаполнитьИсточникНаСервере(КоличествоСтрок)
	
	Источник = Новый ТаблицаЗначений;
	
	МаксКоличествоКолонок = 0;
	
	Для СчетчикСтрок = 1 По КоличествоСтрок Цикл
		
		ТекущаяСтрока = ТекстИсточника.ПолучитьСтроку(СчетчикСтрок);
		МассивЗначений = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(ТекущаяСтрока, ";");
		КоличествоКолонок = МассивЗначений.Количество();
		
		Если КоличествоКолонок < 1 тогда
			Продолжить;
		КонецЕсли;
		
		Если КоличествоКолонок > МаксКоличествоКолонок Тогда
			Для СчетчикКолонок = МаксКоличествоКолонок + 1 По КоличествоКолонок Цикл
				НоваяКолонка = Источник.Колонки.Добавить();
				НоваяКолонка.Имя = "Колонка" + СокрЛП(СчетчикКолонок);
				НоваяКолонка.Заголовок = "Колонка №" + СокрЛП(СчетчикКолонок);
			КонецЦикла;
			МаксКоличествоКолонок = КоличествоКолонок;
		КонецЕсли;
		
		НоваяСтрока = Источник.Добавить();
		Для СчетчикКолонок = 0 По КоличествоКолонок - 1 Цикл
			НоваяСтрока[СчетчикКолонок] = МассивЗначений[СчетчикКолонок];
		КонецЦикла;
		
	КонецЦикла;
	
	ИсточникАдрес = ПоместитьВоВременноеХранилище(Источник, ЭтаФорма.УникальныйИдентификатор);
	
	Возврат ИсточникАдрес;
	
КонецФункции

&НаКлиенте
Процедура ПрочитатьФайлИсточник()
	
	Файл = СокрЛП(ПутьКФайлу);
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ЧтениеТекста", ЭтаФорма);
	
	Если ПодключитьРасширениеРаботыСФайлами() Тогда
		ТекстИсточника.НачатьЧтение(ОписаниеОповещения, Файл);
	Иначе
		ФайлЗагр = Новый Файл(Файл);
		Если ФайлЗагр.Существует() = Ложь Тогда
			ТекстСообщения = НСтр("ru = 'Файла %Файл% не существует!';uk='Файлу %Файл% не існує!'");
			ТекстСообщения = СтрЗаменить(ТекстСообщения, "%Файл%", Файл);
			Сообщить(ТекстСообщения);
			Возврат;
		КонецЕсли;
		Попытка
			ТекстИсточника.Прочитать(Файл);
		Исключение
			ТекстСообщения = НСтр("ru = 'Файл не прочитан.';uk='Файл не читається.'");
			Сообщить(ТекстСообщения);
			Сообщить(НСтр("ru = 'Ошибка при чтении файла-источника '; uk='Помилка при читанні файла-джерела '") + ОписаниеОшибки());
			Возврат;
		КонецПопытки;
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ЧтениеТекста(Ответ) Экспорт
	
	//Если ТипЗнч(Ответ) = Тип("Массив") И Ответ.Количество() <> 0 Тогда
	//	ПутьКФайлу = Ответ[0]; //ДобавитьКонечныйРазделительПути(Ответ[0]);
	//КонецЕсли;	
 
	КоличествоСтрок = ТекстИсточника.КоличествоСтрок();
	
	Если КоличествоСтрок < 1 Тогда
		ТекстСообщения = НСтр("ru = 'В файле нет данных!';uk='У файлі немає даних!'");
		Сообщить(ТекстСообщения);
		Возврат;
	КонецЕсли;
	
	ИсточникАдрес = Неопределено;
	
	ИсточникАдрес = ЗаполнитьИсточникНаСервере(КоличествоСтрок);
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьПредставлениеИсточника()

	ПредставлениеИсточника.Очистить();
	
	Обработка = РеквизитФормыВЗначение("Объект");
	Макет = Обработка.ПолучитьМакет("Макет");
	ОбластьПустая = Макет.ПолучитьОбласть("Пустая");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
	ОбластьЯчейка = Макет.ПолучитьОбласть("Ячейка");
	
	Источник = ПолучитьИзВременногоХранилища(ИсточникАдрес);

	ПредставлениеИсточника.Вывести(ОбластьПустая);
	Для каждого КолонкаИсточника Из Источник.Колонки Цикл
		ОбластьШапка.Параметры.Текст = КолонкаИсточника.Заголовок;
		ПредставлениеИсточника.Присоединить(ОбластьШапка);
	КонецЦикла;
	
	КоличествоКолонок = Источник.Колонки.Количество();
	Для каждого СтрокаИсточника Из Источник Цикл
		ПредставлениеИсточника.Вывести(ОбластьПустая);
		Для СчетчикКолонок = 0 По КоличествоКолонок -1  Цикл
			ОбластьЯчейка.Параметры.Текст = СтрокаИсточника[СчетчикКолонок];
			ПредставлениеИсточника.Присоединить(ОбластьЯчейка);
		КонецЦикла;
	КонецЦикла;
	
	Элементы.РеквизитыНомерКолонки.МаксимальноеЗначение = Источник.Колонки.Количество();
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСписокЗагрузки()
	
	Объект.СписокЗагрузки.Очистить();
	ТаблицаЗагрузки = Объект.СписокЗагрузки.Выгрузить();
	
	Источник = ПолучитьИзВременногоХранилища(ИсточникАдрес);
	
	Если ВидОперации = "Контрагенты" Тогда
		Менеджер = Справочники.Контрагенты;
	ИначеЕсли ВидОперации = "Номенклатура"
		  ИЛИ ВидОперации = "Цены"
		  ИЛИ ВидОперации = "Остатки" Тогда
		Менеджер = Справочники.Номенклатура;
	Иначе
		Возврат;
	КонецЕсли;
	
	Для СчетчикСтрок = 0 по Источник.Количество() - 1 Цикл
		
		Если ВидОперации = "Цены" ИЛИ ВидОперации = "Остатки" Тогда
			
			НомерКолонки = НайтиНомерКолонкиРеквизита(?(ВидОперации = "Цены", "Цена", "Количество"));
			Если НомерКолонки = Неопределено Тогда
				Продолжить;
			Иначе
				Попытка
					СтрокаЧисло = Источник[СчетчикСтрок][НомерКолонки - 1];
					СтрокаЧисло = СтрЗаменить(СтрокаЧисло, " ", "");
					СтрокаЧисло = СтрЗаменить(СтрокаЧисло, "'", "");
					Если Число(СтрокаЧисло) = 0 Тогда
						ТекстСообщения = НСтр("ru='Строка №%НомерСтроки% не может быть загружена, т.к. значение в колонке ""%НомерКолонки%"" равно 0.';uk='Рядок №%НомерСтроки% не може бути завантажено, тому що значення в колонці ""%НомерКолонки%"" дорівнює 0.'");
						ТекстСообщения = СтрЗаменить(ТекстСообщения, "%НомерСтроки%", Строка(СчетчикСтрок+1));
						ТекстСообщения = СтрЗаменить(ТекстСообщения, "%НомерКолонки%", НомерКолонки+1);
						Сообщение = Новый СообщениеПользователю;
						Сообщение.Текст = ТекстСообщения;
						Сообщение.Сообщить();
						Продолжить;
					КонецЕсли;
				Исключение
					ТекстСообщения = НСтр("ru='Строка №%НомерСтроки% не может быть загружена, т.к. значение в колонке ""%НомерКолонки%"" не является числом.';uk='Рядок №%НомерСтроки% не може бути завантажено, тому що значення в колонці ""%НомерКолонки%"" не є числом.'");
					ТекстСообщения = СтрЗаменить(ТекстСообщения, "%НомерСтроки%", Строка(СчетчикСтрок+1));
					ТекстСообщения = СтрЗаменить(ТекстСообщения, "%НомерКолонки%", НомерКолонки+1);
					Сообщение = Новый СообщениеПользователю;
					Сообщение.Текст = ТекстСообщения;
					Сообщение.Сообщить();
					Продолжить;
				КонецПопытки;
			КонецЕсли;
		КонецЕсли;
		
		Наименование = "";
		НаименованиеПолное = "";
		
		НомерКолонки = НайтиНомерКолонкиРеквизита("Наименование");
		Если НомерКолонки <> Неопределено Тогда
			Наименование = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
		КонецЕсли;
		
		НомерКолонки = НайтиНомерКолонкиРеквизита("НаименованиеПолное");
		Если НомерКолонки <> Неопределено Тогда
			НаименованиеПолное = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
		КонецЕсли;
		
		НаименованиеДляПоиска = Лев(Наименование, 100);
		
		Ссылка = Менеджер.НайтиПоНаименованию(НаименованиеДляПоиска);
		
		НоваяСтрока = ТаблицаЗагрузки.Добавить();
		НоваяСтрока.Наименование = Наименование;
		НоваяСтрока.Ссылка = Ссылка;
		НоваяСтрока.ЭтоНовый = Ссылка.Пустая();
		
		НомерКолонки = НайтиНомерКолонкиРеквизита("Артикул");
		Если НомерКолонки <> Неопределено Тогда
			НоваяСтрока.Артикул = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
		КонецЕсли;
		НомерКолонки = НайтиНомерКолонкиРеквизита("Код");
		Если НомерКолонки <> Неопределено Тогда
			НоваяСтрока.Код = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
		КонецЕсли;
		НомерКолонки = НайтиНомерКолонкиРеквизита("Ндс");
		Если НомерКолонки <> Неопределено Тогда
			НоваяСтрока.НДС = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
		КонецЕсли;
		НомерКолонки = НайтиНомерКолонкиРеквизита("Штрих-код");
		Если НомерКолонки <> Неопределено Тогда
			НоваяСтрока.ШтрихКод = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
		КонецЕсли;
		НомерКолонки = НайтиНомерКолонкиРеквизита("Комментарий");
		Если НомерКолонки <> Неопределено Тогда
			НоваяСтрока.Комментарий = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
		КонецЕсли;
		НомерКолонки = НайтиНомерКолонкиРеквизита("НаименованиеПолное");
		Если НомерКолонки <> Неопределено Тогда
			НоваяСтрока.НаименованиеПолное = НаименованиеПолное;
		Иначе
			НоваяСтрока.Наименование = Наименование;
		КонецЕсли;
		НомерКолонки = НайтиНомерКолонкиРеквизита("ИНН");
		Если НомерКолонки <> Неопределено Тогда
			НоваяСтрока.ИНН = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
		КонецЕсли;
		НомерКолонки = НайтиНомерКолонкиРеквизита("ЕДРПОУ");
		Если НомерКолонки <> Неопределено Тогда
			НоваяСтрока.ЕДРПОУ = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
		КонецЕсли;
		НомерКолонки = НайтиНомерКолонкиРеквизита("Цена");
		Если НомерКолонки <> Неопределено Тогда
			СтрокаЧисло = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
			СтрокаЧисло = СтрЗаменить(СтрокаЧисло, " ", "");
			СтрокаЧисло = СтрЗаменить(СтрокаЧисло, "'", "");
			НоваяСтрока.Цена = СтрокаЧисло;
		КонецЕсли;
		НомерКолонки = НайтиНомерКолонкиРеквизита("ГТД");
		Если НомерКолонки <> Неопределено Тогда
			НоваяСтрока.НомерГТД = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
		КонецЕсли;
		НомерКолонки = НайтиНомерКолонкиРеквизита("Количество");
		Если НомерКолонки <> Неопределено Тогда
			СтрокаЧисло = СокрЛП(Источник[СчетчикСтрок][НомерКолонки - 1]);
			СтрокаЧисло = СтрЗаменить(СтрокаЧисло, " ", "");
			СтрокаЧисло = СтрЗаменить(СтрокаЧисло, "'", "");
			НоваяСтрока.Количество = СтрокаЧисло;
		КонецЕсли;
		
		Если ВидОперации = "Цены"
		 ИЛИ ВидОперации = "Остатки" Тогда
			НоваяСтрока.ФлагЗагрузки = Истина;
		Иначе
			НоваяСтрока.ФлагЗагрузки = НоваяСтрока.ЭтоНовый;
		КонецЕсли;
		
		Если ВидОперации = "Цены" Тогда
			
			Запрос = Новый Запрос;
			
			Если ЗначениеЗаполнено(НоваяСтрока.ШтрихКод) И ИдКонф <> "UABY" Тогда
				
				Запрос.Текст = 
				"ВЫБРАТЬ ПЕРВЫЕ 1
				|	ШтрихкодыНоменклатуры.Номенклатура КАК Номенклатура,
				|	ШтрихкодыНоменклатуры.Номенклатура.Артикул КАК Артикул,
				|	ШтрихкодыНоменклатуры.Номенклатура.Код КАК Код,
				|	ШтрихкодыНоменклатуры.Номенклатура.Наименование КАК Наименование,
				|	ШтрихкодыНоменклатуры.Характеристика КАК Характеристика,
				|	ШтрихкодыНоменклатуры.ЕдиницаИзмерения КАК ЕдиницаИзмерения
				|ИЗ
				|	РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
				|ГДЕ
				|	ШтрихкодыНоменклатуры.Штрихкод = &Штрихкод";
				Запрос.УстановитьПараметр("Штрихкод", НоваяСтрока.ШтрихКод);
			
			ИначеЕсли ЗначениеЗаполнено(НоваяСтрока.Артикул) Тогда
				Если ИдКонф = "UABY" Тогда
					ПолеПоиска = "Код"
				Иначе
					ПолеПоиска = "Артикул"
				КонецЕсли;
				ЗначениеПоляПоиска = НоваяСтрока.Артикул; 
			ИначеЕсли ЗначениеЗаполнено(НоваяСтрока.Код) Тогда 	
				ПолеПоиска = "Код";
				ЗначениеПоляПоиска = НоваяСтрока.Код; 
			Иначе
				Продолжить;
			КонецЕсли;	

			Если ИдКонф = "UABY" Тогда
				Если Запрос.Текст = "" Тогда
					Запрос.Текст = 
					"ВЫБРАТЬ ПЕРВЫЕ 1
					|	СпрНоменклатура.Ссылка КАК Номенклатура,
					|	"""" КАК Артикул,
					|	СпрНоменклатура.Код КАК Код,
					|	СпрНоменклатура.Наименование КАК Наименование,
					|	"""" КАК Характеристика
					
					|ИЗ
					|	Справочник.ТоварноМатериальныеЦенности КАК СпрНоменклатура
					|ГДЕ
					|	НЕ СпрНоменклатура.ПометкаУдаления
					|	И СпрНоменклатура." + ПолеПоиска + " = &ПолеПоиска";
					Запрос.УстановитьПараметр("ПолеПоиска", ЗначениеПоляПоиска)
				КонецЕсли
			Иначе
				Если Запрос.Текст = "" Тогда
					Запрос.Текст = 
					"ВЫБРАТЬ ПЕРВЫЕ 1
					|	СпрНоменклатура.Ссылка КАК Номенклатура,
					|	СпрНоменклатура.Артикул КАК Артикул,
					|	СпрНоменклатура.Код КАК Код,
					|	СпрНоменклатура.Наименование КАК Наименование,
					|	"""" КАК Характеристика
					
					|ИЗ
					|	Справочник.Номенклатура КАК СпрНоменклатура
					|ГДЕ
					|	НЕ СпрНоменклатура.ПометкаУдаления
					|	И СпрНоменклатура." + ПолеПоиска + " = &ПолеПоиска";
					Запрос.УстановитьПараметр("ПолеПоиска", ЗначениеПоляПоиска)
				КонецЕсли
			КонецЕсли;
			
			РезультатЗапроса = Запрос.Выполнить();
			
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			НоваяСтрока.Ссылка = Неопределено;
			НоваяСтрока.ЭтоНовый = Истина;
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				НоваяСтрока.Наименование = ВыборкаДетальныеЗаписи.Наименование;
				НоваяСтрока.Ссылка = ВыборкаДетальныеЗаписи.Номенклатура;
				НоваяСтрока.ЭтоНовый = Ложь;
				НоваяСтрока.ХарактеристикаНоменклатуры = ВыборкаДетальныеЗаписи.Характеристика;
				
				Если ИдКонф = "UNF" Или ИдКонф = "UABY" Тогда 
					НоваяСтрока.ЕдиницаИзмерения = ВыборкаДетальныеЗаписи.Номенклатура.ЕдиницаИзмерения;
				ИначеЕсли ИдКонф = "BP" Тогда  
					Попытка
						НоваяСтрока.ЕдиницаИзмерения = ВыборкаДетальныеЗаписи.Номенклатура.ЕдиницыИзмерения[0].ЕдиницаИзмерения;	
					Исключение
					КонецПопытки;	
				КонецЕсли;	
					
				НоваяСтрока.Артикул = ВыборкаДетальныеЗаписи.Артикул;
				НоваяСтрока.Код = ВыборкаДетальныеЗаписи.Код;
				
			КонецЦикла;
		КонецЕсли;

	КонецЦикла;
	
	ТаблицаЗагрузки.Свернуть("Наименование, ХарактеристикаНоменклатуры, ЕдиницаИзмерения, Ссылка,ЭтоНовый,Артикул,Код,НДС,ШтрихКод,НомерГТД,Комментарий,НаименованиеПолное,ИНН,ЕДРПОУ,Цена,ФлагЗагрузки","Количество");

	Объект.СписокЗагрузки.Загрузить(ТаблицаЗагрузки);
	
КонецПроцедуры

&НаСервере
Функция НайтиНомерКолонкиРеквизита(ИмяРеквизита)
	
	НайденныйРеквизит = Неопределено;
	НайденныеСтроки = Реквизиты.НайтиСтроки(Новый Структура("ИмяРеквизита", ИмяРеквизита));
	Если НайденныеСтроки.Количество() > 0 Тогда
		НайденныйРеквизит = НайденныеСтроки[0].НомерКолонки;
	КонецЕсли;
	
	Возврат ?(НайденныйРеквизит = 0, Неопределено, НайденныйРеквизит);
	
КонецФункции

&НаСервере
Функция НайтиСтавкуНДС(Ставка)
	
	Если ПустаяСтрока(Ставка) Тогда
		Возврат Неопределено;
	КонецЕсли;
	
	Менеджер = Справочники.СтавкиНДС;
	Ссылка = Менеджер.НайтиПоНаименованию(СокрЛП(Ставка), Истина);
	Если НЕ Ссылка.Пустая() Тогда
		Возврат Ссылка;
	КонецЕсли;
	
	Попытка
		
		РазмерСтавки = Число(СокрЛП(Ставка));
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	СтавкиНДС.Ссылка
		|ИЗ
		|	Справочник.СтавкиНДС КАК СтавкиНДС
		|ГДЕ
		|	СтавкиНДС.Ставка = &РазмерСтавки";
		
		Запрос.УстановитьПараметр("РазмерСтавки", РазмерСтавки);
		
		Результат = Запрос.Выполнить().Выгрузить();
		Если Результат.Количество() > 0 Тогда
			Возврат Результат[0].Ссылка;
		КонецЕсли;
		
	Исключение
	
	КонецПопытки;
	
	Возврат Неопределено;
	
КонецФункции // НайтиСтавкуНДС()

&НаСервере
Процедура Загрузить(Отказ)
	
	Если Объект.СписокЗагрузки.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	РеквизитФормыВЗначение("Объект").UNF_Загрузка_ПроверитьДублиСтрок(Отказ);
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	
	Если ВидОперации = "Цены" Тогда
		Если ИдКонф = "UABY" Тогда
			Менеджер = Справочники.ТоварноМатериальныеЦенности
		Иначе
			Менеджер = Справочники.Номенклатура
		КонецЕсли;
		Если ИдКонф = "BP" Тогда
			ДокЦен = Документы.УстановкаЦенНоменклатуры.СоздатьДокумент();	
		КонецЕсли;	
	ИначеЕсли ВидОперации = "Остатки" Тогда
		Если ИдКонф = "UABY" Тогда
			Возврат
		КонецЕсли;
		ДокументВводОстатков = Документы.ВводНачальныхОстатков.СоздатьДокумент();
		
		Если ИдКонф = "UNF" Тогда 
			ДокументВводОстатков.РазделУчета = "Запасы";
			ДокументВводОстатков.Организация = Справочники.Организации.ОсновнаяОрганизация;
		ИначеЕсли ИдКонф = "BP" Тогда
			ДокументВводОстатков.РазделУчета = Перечисления.РазделыУчетаДляВводаОстатков.ЗапасыСебестоимость;
			ДокументВводОстатков.Организация = Справочники.Организации.ОрганизацияПоУмолчанию();
		КонецЕсли;
		
		ДокументВводОстатков.Дата = ?(ЗначениеЗаполнено(Дата), Дата, ТекущаяДата());
		ДокументВводОстатков.Комментарий = "# Документ введен обработкой загрузки данных из электронной таблицы.";
		Менеджер = Справочники.Номенклатура;
		
	ИначеЕсли ВидОперации = "Номенклатура" Тогда
		Если ИдКонф = "UABY" Тогда
			Менеджер = Справочники.ТоварноМатериальныеЦенности
		Иначе
			Менеджер = Справочники.Номенклатура
		КонецЕсли
	ИначеЕсли ВидОперации = "Контрагенты" Тогда
		Менеджер = Справочники.Контрагенты;
	КонецЕсли;
	
	Для каждого СтрокаЗагрузки Из Объект.СписокЗагрузки Цикл
	
		Если НЕ СтрокаЗагрузки.ФлагЗагрузки Тогда
			Продолжить;
		КонецЕсли;
		
		Если СтрокаЗагрузки.Ссылка.Пустая() Тогда
			ОбъектДляЗаписи = Менеджер.СоздатьЭлемент();
		Иначе
			ОбъектДляЗаписи = СтрокаЗагрузки.Ссылка.ПолучитьОбъект();
		КонецЕсли;
		
		Если ИдКонф = "UNF" Тогда
			
			Если ВидОперации = "Контрагенты" Тогда
				
				ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
				ОбъектДляЗаписи.НаименованиеПолное = ОбъектДляЗаписи.НаименованиеПолное;
				Если СтрДлина(ОбъектДляЗаписи.ИНН) = 12 Тогда
					ОбъектДляЗаписи.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ФизЛицо;
				Иначе
					ОбъектДляЗаписи.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ЮрЛицо;
				КонецЕсли;
				ОбъектДляЗаписи.СчетУчетаРасчетовСПокупателем = ПланыСчетов.Управленческий.РасчетыСПокупателями;
				ОбъектДляЗаписи.СчетУчетаАвансовПокупателя = ПланыСчетов.Управленческий.РасчетыПоАвансамПолученным;
				ОбъектДляЗаписи.СчетУчетаРасчетовСПоставщиком = ПланыСчетов.Управленческий.РасчетыСПоставщиками;
				ОбъектДляЗаписи.СчетУчетаАвансовПоставщику = ПланыСчетов.Управленческий.РасчетыПоАвансамВыданным;
				ОбъектДляЗаписи.ВестиРасчетыПоДоговорам = Истина;
				ОбъектДляЗаписи.ВестиРасчетыПоДокументам = Истина;
				ОбъектДляЗаписи.ВестиРасчетыПоЗаказам = Истина;
				ОбъектДляЗаписи.ВестиУчетОплатыПоСчетам = Истина;
				ОбъектДляЗаписи.Записать();
				
			ИначеЕсли ВидОперации = "Номенклатура" Тогда
				
				ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
				ОбъектДляЗаписи.НаименованиеПолное = СтрокаЗагрузки.Наименование;
				ОбъектДляЗаписи.ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.шт;
				
				ОбъектДляЗаписи.СчетУчетаЗапасов = ПланыСчетов.Управленческий.СырьеИМатериалы;
				ОбъектДляЗаписи.СчетУчетаЗатрат = ПланыСчетов.Управленческий.НезавершенноеПроизводство;
				ОбъектДляЗаписи.СпособПополнения = Перечисления.СпособыПополненияЗапасов.Закупка;
				ОбъектДляЗаписи.МетодОценки = Перечисления.МетодОценкиЗапасов.ПоСредней;
				ОбъектДляЗаписи.НаправлениеДеятельности = Справочники.НаправленияДеятельности.ОсновноеНаправление;
				ОбъектДляЗаписи.ТипНоменклатуры = Перечисления.ТипыНоменклатуры.Запас;
				ОбъектДляЗаписи.СтранаПроисхождения = СтранаПроисхождения;
				
				СтавкаНДС = НайтиСтавкуНДС(СтрокаЗагрузки.НДС);
				Если СтавкаНДС <>Неопределено Тогда
					ОбъектДляЗаписи.СтавкаНДС = СтавкаНДС;
				Иначе
					ОбъектДляЗаписи.СтавкаНДС = ?(ЗначениеЗаполнено(ОбъектДляЗаписи.СтавкаНДС), ОбъектДляЗаписи.СтавкаНДС, Справочники.Организации.ОсновнаяОрганизация.СтавкаНДСПоУмолчанию);
				КонецЕсли;
				
				ОбъектДляЗаписи.Записать();
				
				Если ЗначениеЗаполнено(СтрокаЗагрузки.ШтрихКод) Тогда
					НаборЗаписейШтрихКодыНоменклатуры = РегистрыСведений.ШтрихкодыНоменклатуры.СоздатьНаборЗаписей();
					НаборЗаписейШтрихКодыНоменклатуры.Отбор.ШтрихКод.Установить(СтрокаЗагрузки.ШтрихКод);
					НоваяСтрока = НаборЗаписейШтрихКодыНоменклатуры.Добавить();
					НоваяСтрока.Номенклатура = ОбъектДляЗаписи.Ссылка;
					НоваяСтрока.ШтрихКод = СтрокаЗагрузки.ШтрихКод;
					НаборЗаписейШтрихКодыНоменклатуры.Записать(Истина);
				КонецЕсли;
				
			ИначеЕсли ВидОперации = "Цены" Тогда
				
				Если НЕ ЗначениеЗаполнено(ОбъектДляЗаписи.Ссылка) Тогда
					
					ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
					ОбъектДляЗаписи.НаименованиеПолное = СтрокаЗагрузки.Наименование;
					ОбъектДляЗаписи.ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.шт;
					
					ОбъектДляЗаписи.СчетУчетаЗапасов = ПланыСчетов.Управленческий.СырьеИМатериалы;
					ОбъектДляЗаписи.СчетУчетаЗатрат = ПланыСчетов.Управленческий.НезавершенноеПроизводство;
					ОбъектДляЗаписи.СпособПополнения = Перечисления.СпособыПополненияЗапасов.Закупка;
					ОбъектДляЗаписи.МетодОценки = Перечисления.МетодОценкиЗапасов.ПоСредней;
					ОбъектДляЗаписи.НаправлениеДеятельности = Справочники.НаправленияДеятельности.ОсновноеНаправление;
					ОбъектДляЗаписи.ТипНоменклатуры = Перечисления.ТипыНоменклатуры.Запас;
					ОбъектДляЗаписи.СтранаПроисхождения = СтранаПроисхождения;
					
					СтавкаНДС = НайтиСтавкуНДС(СтрокаЗагрузки.НДС);
					Если СтавкаНДС <>Неопределено Тогда
						ОбъектДляЗаписи.СтавкаНДС = СтавкаНДС;
					Иначе
						ОбъектДляЗаписи.СтавкаНДС = ?(ЗначениеЗаполнено(ОбъектДляЗаписи.СтавкаНДС), ОбъектДляЗаписи.СтавкаНДС, Справочники.Организации.ОсновнаяОрганизация.СтавкаНДСПоУмолчанию);
					КонецЕсли;
					
					ОбъектДляЗаписи.Записать();
					
					Если ЗначениеЗаполнено(СтрокаЗагрузки.ШтрихКод) Тогда
						НаборЗаписейШтрихКодыНоменклатуры = РегистрыСведений.ШтрихкодыНоменклатуры.СоздатьНаборЗаписей();
						НаборЗаписейШтрихКодыНоменклатуры.Отбор.ШтрихКод.Установить(СтрокаЗагрузки.ШтрихКод);
						НоваяСтрока = НаборЗаписейШтрихКодыНоменклатуры.Добавить();
						НоваяСтрока.Номенклатура = ОбъектДляЗаписи.Ссылка;
						НоваяСтрока.ШтрихКод = СтрокаЗагрузки.ШтрихКод;
						НаборЗаписейШтрихКодыНоменклатуры.Записать(Истина);
					КонецЕсли;
					
				КонецЕсли;
				
				НаборЗаписейЦеныНоменклатуры = РегистрыСведений.ЦеныНоменклатуры.СоздатьНаборЗаписей();
				НаборЗаписейЦеныНоменклатуры.Отбор.Период.Установить(?(ЗначениеЗаполнено(Дата), Дата, ТекущаяДата()));
				НаборЗаписейЦеныНоменклатуры.Отбор.ВидЦен.Установить(?(ЗначениеЗаполнено(ВидЦен), ВидЦен, Справочники.ВидыЦен.Оптовая));
				НаборЗаписейЦеныНоменклатуры.Отбор.Номенклатура.Установить(ОбъектДляЗаписи.Ссылка);
				
				Если ЗначениеЗаполнено(СтрокаЗагрузки.ХарактеристикаНоменклатуры) Тогда
					НаборЗаписейЦеныНоменклатуры.Отбор.Характеристика.Установить(СтрокаЗагрузки.ХарактеристикаНоменклатуры);
				Иначе	
					НаборЗаписейЦеныНоменклатуры.Отбор.Характеристика.Установить(Справочники.ХарактеристикиНоменклатуры.ПустаяСсылка());
				КонецЕсли;	
				
				НоваяСтрока = НаборЗаписейЦеныНоменклатуры.Добавить();
				НоваяСтрока.Номенклатура = ОбъектДляЗаписи.Ссылка;
				НоваяСтрока.ВидЦен = ?(ЗначениеЗаполнено(ВидЦен), ВидЦен, Справочники.ВидыЦен.Оптовая);
				НоваяСтрока.Актуальность = Истина;
				НоваяСтрока.Период = ?(ЗначениеЗаполнено(Дата), Дата, ТекущаяДата());
				НоваяСтрока.Цена = СтрокаЗагрузки.Цена;
				НоваяСтрока.ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.шт;
				
				Если ЗначениеЗаполнено(СтрокаЗагрузки.ХарактеристикаНоменклатуры) Тогда
					НоваяСтрока.Характеристика = СтрокаЗагрузки.ХарактеристикаНоменклатуры; 
					Если ЗначениеЗаполнено(СтрокаЗагрузки.ЕдиницаИзмерения) Тогда
						НоваяСтрока.ЕдиницаИзмерения = СтрокаЗагрузки.ЕдиницаИзмерения; 
					КонецЕсли;	
				КонецЕсли;	
				
				НаборЗаписейЦеныНоменклатуры.Записать(Истина);
				
			ИначеЕсли ВидОперации = "Остатки" Тогда
				
				Если НЕ ЗначениеЗаполнено(ОбъектДляЗаписи.Ссылка) Тогда
					
					ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
					ОбъектДляЗаписи.НаименованиеПолное = СтрокаЗагрузки.Наименование;
					ОбъектДляЗаписи.ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.шт;
					
					ОбъектДляЗаписи.СчетУчетаЗапасов = ПланыСчетов.Управленческий.СырьеИМатериалы;
					ОбъектДляЗаписи.СчетУчетаЗатрат = ПланыСчетов.Управленческий.НезавершенноеПроизводство;
					ОбъектДляЗаписи.СпособПополнения = Перечисления.СпособыПополненияЗапасов.Закупка;
					ОбъектДляЗаписи.МетодОценки = Перечисления.МетодОценкиЗапасов.ПоСредней;
					ОбъектДляЗаписи.НаправлениеДеятельности = Справочники.НаправленияДеятельности.ОсновноеНаправление;
					ОбъектДляЗаписи.ТипНоменклатуры = Перечисления.ТипыНоменклатуры.Запас;
					ОбъектДляЗаписи.СтранаПроисхождения = СтранаПроисхождения;
					
					СтавкаНДС = НайтиСтавкуНДС(СтрокаЗагрузки.НДС);
					Если СтавкаНДС <>Неопределено Тогда
						ОбъектДляЗаписи.СтавкаНДС = СтавкаНДС;
					Иначе
						ОбъектДляЗаписи.СтавкаНДС = ?(ЗначениеЗаполнено(ОбъектДляЗаписи.СтавкаНДС), ОбъектДляЗаписи.СтавкаНДС, Справочники.Организации.ОсновнаяОрганизация.СтавкаНДСПоУмолчанию);
					КонецЕсли;
					
					ОбъектДляЗаписи.Записать();
					
				КонецЕсли;
				
				Если ОбъектДляЗаписи.ТипНоменклатуры = Перечисления.ТипыНоменклатуры.Запас Тогда
					НоваяСтрока = ДокументВводОстатков.Запасы.Добавить();
					НоваяСтрока.Номенклатура = ОбъектДляЗаписи.Ссылка;
					НоваяСтрока.Количество = СтрокаЗагрузки.Количество;
					НоваяСтрока.Цена = СтрокаЗагрузки.Цена;
					НоваяСтрока.Сумма = НоваяСтрока.Количество * НоваяСтрока.Цена;
					НоваяСтрока.ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.шт;
					НоваяСтрока.СтруктурнаяЕдиница = ?(ЗначениеЗаполнено(Склад), Склад, Справочники.СтруктурныеЕдиницы.ОсновнойСклад);
				Иначе
					Сообщить("Позиция """ + СокрЛП(ОбъектДляЗаписи.Ссылка)+""" является услугой, остатки по ней не будут загружены!");
				КонецЕсли;
				
			КонецЕсли;
			
		ИначеЕсли ИдКонф = "BP" Тогда
			
			Если ВидОперации = "Контрагенты" Тогда
				
				ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
				ОбъектДляЗаписи.НаименованиеПолное = ОбъектДляЗаписи.НаименованиеПолное;
				Если СтрДлина(ОбъектДляЗаписи.ИНН) = 12 Тогда
					ОбъектДляЗаписи.ЮридическоеФизическоеЛицо = Перечисления.ЮридическоеФизическоеЛицо.ФизическоеЛицо;
				Иначе
					ОбъектДляЗаписи.ЮридическоеФизическоеЛицо = Перечисления.ЮридическоеФизическоеЛицо.ЮридическоеЛицо;
				КонецЕсли;
				
				ОбъектДляЗаписи.КодПоЕДРПОУ = СтрокаЗагрузки.ЕДРПОУ;
				
				Попытка
					ОбъектДляЗаписи.Записать();
				Исключение
					Сообщить("Запись строки " + ОбъектДляЗаписи.НомерСтроки);
					Сообщить(НСтр("ru = 'Ошибка при загрузке '; uk='Помилка при завантаженні '") + ОписаниеОшибки());	
				КонецПопытки;	
				
			ИначеЕсли ВидОперации = "Номенклатура" Тогда
				
				ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
				ОбъектДляЗаписи.НаименованиеПолное = СтрокаЗагрузки.Наименование;
				
				НоваяСтрока = ОбъектДляЗаписи.ЕдиницыИзмерения.Добавить();
				НоваяСтрока.ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.ПолучитьЕдиницуИзмеренияПоУмолчанию();
				НоваяСтрока.Коэффициент = 1;
				
				ОбъектДляЗаписи.Записать();
				
			ИначеЕсли ВидОперации = "Цены" Тогда
				
				Если НЕ ЗначениеЗаполнено(ОбъектДляЗаписи.Ссылка) Тогда
					
					ОбъектДляЗаписи = Справочники.Номенклатура.СоздатьЭлемент();
					
					ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
					ОбъектДляЗаписи.НаименованиеПолное = СтрокаЗагрузки.Наименование;
					
					НоваяСтрока = ОбъектДляЗаписи.ЕдиницыИзмерения.Добавить();
					НоваяСтрока.ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.ПолучитьЕдиницуИзмеренияПоУмолчанию();
					НоваяСтрока.Коэффициент = 1;

					
					ОбъектДляЗаписи.Записать();
										
				КонецЕсли;
				
				ДокЦен.Дата = ?(ЗначениеЗаполнено(Дата), Дата, ТекущаяДата());
				ДокЦен.ТипЦен = ВидЦен;
				
				НоваяСтрока = ДокЦен.Товары.Добавить();
				НоваяСтрока.Номенклатура = ОбъектДляЗаписи.Ссылка;
			
				НоваяСтрока.Цена = СтрокаЗагрузки.Цена;
				НоваяСтрока.Валюта = Справочники.Валюты.НайтиПоКоду("980");
				
				Попытка
					ДокЦен.Записать(РежимЗаписиДокумента.Запись);
				Исключение
				КонецПопытки;	
				
			ИначеЕсли ВидОперации = "Остатки" Тогда
				
				Если НЕ ЗначениеЗаполнено(ОбъектДляЗаписи.Ссылка) Тогда
					
					ОбъектДляЗаписи = Справочники.Номенклатура.СоздатьЭлемент();
					
					ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
					ОбъектДляЗаписи.НаименованиеПолное = СтрокаЗагрузки.Наименование;
					
					НоваяСтрока = ОбъектДляЗаписи.ЕдиницыИзмерения.Добавить();
					НоваяСтрока.ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.ПолучитьЕдиницуИзмеренияПоУмолчанию();
					НоваяСтрока.Коэффициент = 1;
					
					ОбъектДляЗаписи.Записать();

				КонецЕсли;
				
				НоваяСтрока = ДокументВводОстатков.ЗапасыВсе.Добавить();
				НоваяСтрока.Номенклатура = ОбъектДляЗаписи.Ссылка;
				НоваяСтрока.Количество = СтрокаЗагрузки.Количество;
				НоваяСтрока.Цена = СтрокаЗагрузки.Цена;
				НоваяСтрока.Сумма = НоваяСтрока.Количество * НоваяСтрока.Цена;
				НоваяСтрока.СчетУчета = ПланыСчетов.Хозрасчетный.ТоварыНаСкладе;
				НоваяСтрока.НалоговоеНазначение = Справочники.НалоговыеНазначенияАктивовИЗатрат.НДС_Облагаемая;
				
			КонецЕсли;

		ИначеЕсли ИдКонф = "UABY" Тогда

			Если ВидОперации = "Контрагенты" Тогда
				
				ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
				ОбъектДляЗаписи.НаименованиеПолное = ОбъектДляЗаписи.НаименованиеПолное;
				Если СтрДлина(ОбъектДляЗаписи.ИНН) = 12 Тогда
					ОбъектДляЗаписи.ЮридическоеФизическоеЛицо = Перечисления.ЮридическоеФизическоеЛицо.ФизическоеЛицо;
				Иначе
					ОбъектДляЗаписи.ЮридическоеФизическоеЛицо = Перечисления.ЮридическоеФизическоеЛицо.ЮридическоеЛицо;
				КонецЕсли;

				Попытка
					ОбъектДляЗаписи.Записать();
				Исключение
					Сообщить("Запись строки " + ОбъектДляЗаписи.НомерСтроки);
					Сообщить(НСтр("ru = 'Ошибка при загрузке '; uk='Помилка при завантаженні '") + ОписаниеОшибки());	
				КонецПопытки;	

				Попытка
					НаборКодыКонтрагента = РегистрыСведений.КодыКонтрагентов.СоздатьНаборЗаписей();
					НаборКодыКонтрагента.Отбор.Контрагент.Значение = ОбъектДляЗаписи.Ссылка;
					НаборКодыКонтрагента.Отбор.Период.Значение = ?(ЗначениеЗаполнено(Дата), Дата, ТекущаяДата());
					НаборКодыКонтрагента.Отбор.Контрагент.Использование = Истина;
					НаборКодыКонтрагента.Отбор.Период.Использование = Истина;
					НовЗаписьКодыКонтрагента = НаборКодыКонтрагента.Добавить();
					НовЗаписьКодыКонтрагента.КодЕДРПОУ = СтрокаЗагрузки.ЕДРПОУ;
					НовЗаписьКодыКонтрагента.Период = ?(ЗначениеЗаполнено(Дата), Дата, ТекущаяДата());
					//НовЗаписьКодыКонтрагента.ИНН = ИНН;
					НовЗаписьКодыКонтрагента.Записать(Истина)
				Исключение
				КонецПопытки

			ИначеЕсли ВидОперации = "Номенклатура" Тогда

				ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
				ОбъектДляЗаписи.НаименованиеПолное = СтрокаЗагрузки.Наименование;
				
				ЗаполнитьЗначенияСвойств(ОбъектДляЗаписи, СтрокаЗагрузки);
				ОбъектДляЗаписи.НаименованиеПолное = СтрокаЗагрузки.Наименование;
				Попытка
					ОбъектДляЗаписи.ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.шт
				Исключение
					ОбъектДляЗаписи.ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.НайтиПоНаименованию("шт")
				КонецПопытки;
				
				//ОбъектДляЗаписи.СчетЗабалансовогоУчета = ПланыСчетов.Бюджетный.;
				//ОбъектДляЗаписи.СчетУчета = ПланыСчетов.Бюджетный.;
				ОбъектДляЗаписи.СтранаПроисхождения = СтранаПроисхождения;

				СтавкаНДС = Объект.ПолучитьСтавкуНДСПоСтроковомуПредставлению(СтрокаЗагрузки.НДС);
				Если СтавкаНДС <> Неопределено Тогда
					ОбъектДляЗаписи.СтавкаНДС = СтавкаНДС;
				Иначе
					ОбъектДляЗаписи.СтавкаНДС = Перечисления.СтавкиНДС.НДС20//?(ЗначениеЗаполнено(ОбъектДляЗаписи.СтавкаНДС), ОбъектДляЗаписи.СтавкаНДС, Справочники.Организации.ОсновнаяОрганизация.СтавкаНДСПоУмолчанию);
				КонецЕсли;

				ОбъектДляЗаписи.Записать()

			ИначеЕсли ВидОперации = "Цены" Тогда
			ИначеЕсли ВидОперации = "Остатки" Тогда
			КонецЕсли

		КонецЕсли;

	КонецЦикла;
	
	Если Отказ Тогда
		Сообщить(НСтр("ru='Во время загрузки произошли ошибки. Данные не будут загружены.';uk='Під час завантаження відбулися помилки. Дані не будуть завантажені.'"));
		Возврат;
	КонецЕсли;
	
	Если ВидОперации = "Остатки" Тогда
		Попытка
			ДокументВводОстатков.Записать(РежимЗаписиДокумента.Запись);
		Исключение
		КонецПопытки;	
	КонецЕсли;
	
	
КонецПроцедуры

&НаКлиенте
Процедура ВидОперацииПриИзменении(Элемент)
	
	ЗаполнитьРеквизиты();
	
КонецПроцедуры

&НаКлиенте
Процедура ПриветствиеДалее(Команда)
	
	Если ПодключитьРасширениеРаботыСФайлами() И
	  НЕ ЗначениеЗаполнено(ПутьКФайлу) Тогда
		ТекстСообщения = НСтр("ru='Вначале укажите путь к файлу загрузки!';uk='Спочатку вкажіть шлях до файлу завантаження!'");
		Сообщить(ТекстСообщения);
		Возврат;
	КонецЕсли;
	
	Если Реквизиты.Количество() = 0 Тогда
		ЗаполнитьРеквизиты();
	КонецЕсли;
	
	Элементы.ГруппаСопоставления.Заголовок = ПутьКФайлу;
	ПрочитатьФайлИсточник();
	
	Если НЕ ЗначениеЗаполнено(ИсточникАдрес) Тогда
		Возврат;
	КонецЕсли;
	
	ЗаполнитьПредставлениеИсточника();
	
	Элементы.ЭтапыЗагрузки.ТекущаяСтраница = Элементы.ЭтапыЗагрузки.ПодчиненныеЭлементы.Сопоставление;
	
КонецПроцедуры

&НаКлиенте
Процедура СопоставлениеНазад(Команда)
	
	Элементы.ЭтапыЗагрузки.ТекущаяСтраница = Элементы.ЭтапыЗагрузки.ПодчиненныеЭлементы.Приветствие;
	
КонецПроцедуры

&НаКлиенте
Процедура СопоставлениеДалее(Команда)
	
	Для СчетчикРеквизитов = 0 по Реквизиты.Количество() - 1 Цикл
		Если Реквизиты[СчетчикРеквизитов].Обязательный и Реквизиты[СчетчикРеквизитов].НомерКолонки = 0 Тогда
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = НСтр("ru='Необходимо заполнить колонки для обязательных реквизитов'; uk='Необхідно заповнити колонки для обов`язкових реквізитів'");
			Сообщение.Поле = "Реквизиты[0].НомерКолонки";
			Сообщение.Сообщить(); 
			Возврат;
		КонецЕсли; 
	КонецЦикла;
	
	ЗаполнитьСписокЗагрузки();
	Элементы.ЭтапыЗагрузки.ТекущаяСтраница = Элементы.ЭтапыЗагрузки.ПодчиненныеЭлементы.Создание;
	
КонецПроцедуры

&НаКлиенте
Процедура СозданиеОтметитьВсе(Команда)
	
	Для каждого Элемент Из Объект.СписокЗагрузки Цикл
		Элемент.ФлагЗагрузки = Истина;
	КонецЦикла; 
	
КонецПроцедуры

&НаКлиенте
Процедура СозданиеСнятьОтметку(Команда)
	
	Для каждого Элемент Из Объект.СписокЗагрузки Цикл
		Элемент.ФлагЗагрузки = Ложь;
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ОтметитьТолькоНовые(Команда)
	
	Для каждого Элемент Из Объект.СписокЗагрузки Цикл
		Элемент.ФлагЗагрузки = Элемент.ЭтоНовый;
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура СозданиеНазад(Команда)
	
	Элементы.ЭтапыЗагрузки.ТекущаяСтраница = Элементы.ЭтапыЗагрузки.ПодчиненныеЭлементы.Сопоставление;
	
КонецПроцедуры

&НаКлиенте
Процедура СозданиеВперед(Команда)
	
	Отказ = Ложь;
	ОчиститьСообщения();
	Загрузить(Отказ);
	Если НЕ Отказ Тогда
		Элементы.ЭтапыЗагрузки.ТекущаяСтраница = Элементы.ЭтапыЗагрузки.ПодчиненныеЭлементы.Завершение;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СсылкаНаСписокНажатие(Элемент)
	
	Если ВидОперации = "Контрагенты" Тогда
		ОткрытьФорму("Справочник.Контрагенты.ФормаСписка");
	ИначеЕсли ВидОперации = "Номенклатура" Тогда
		Если ИдКонф = "UABY" Тогда
			ОткрытьФорму("Справочник.ТоварноМатериальныеЦенности.ФормаСписка")
		Иначе
			ОткрытьФорму("Справочник.Номенклатура.ФормаСписка")
		КонецЕсли
	ИначеЕсли ВидОперации = "Цены" Тогда
		Если ИдКонф = "UNF" Тогда
			ОткрытьФорму("Обработка.ПрайсЛист.Форма");
		ИначеЕсли ИдКонф = "BP" Тогда
			ОткрытьФорму("Документ.УстановкаЦенНоменклатуры.ФормаСписка");
		КонецЕсли;
	ИначеЕсли ВидОперации = "Остатки" Тогда
		Если ИдКонф <> "UABY" Тогда
			ОткрытьФорму("Документ.ВводНачальныхОстатков.ФормаСписка")
		КонецЕсли
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ЗавершитьРаботу(Команда)
	
	ЭтаФорма.Закрыть();
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ВидОперации = Параметры.ВидОперации;
	ЗаполнитьРеквизиты();
	ИдКонф = Параметры.ИдКонф;
	Если ИдКонф = "UNF" Тогда
		Склад = Справочники.СтруктурныеЕдиницы.ПустаяСсылка();
		ВидЦен = Справочники.ВидыЦен.Оптовая;
	ИначеЕсли ИдКонф = "BP" Тогда
		Склад = Справочники.Склады.ПустаяСсылка();
		ВидЦен = Справочники.ТипыЦенНоменклатуры.ПустаяСсылка();
	КонецЕсли;	
	
	Дата = ТекущаяДата();
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)

	Если Не ПодключитьРасширениеРаботыСФайлами() Тогда
		//ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru = 'Для данной операции необходимо установить расширение работы с файлами. Операция займет несколько секунд...';uk='Для цієї операції необхідно встановити розширення роботи з файлами. Операція займе кілька секунд...'"));
		НачатьУстановкуРасширенияРаботыСФайлами();
	КонецЕсли;	
	
	Если НЕ ПодключитьРасширениеРаботыСФайлами() Тогда
		Элементы.ПутьКФайлу.Видимость = Ложь;
		Элементы.ПредупреждениеВыгрузка.Видимость = Истина;
	Иначе
		Элементы.ПутьКФайлу.Видимость = Истина;
		Элементы.ПредупреждениеВыгрузка.Видимость = Ложь;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПутьКФайлуОткрытие(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ТекстДок = Новый ТекстовыйДокумент();
	ТекстДок.Прочитать(ПутьКФайлу);
	ТекстДок.Показать(ПутьКФайлу, ПутьКФайлу);
	
КонецПроцедуры
